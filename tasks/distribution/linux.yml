---

- name: manage sysvinit services
  service:
    name: "{{ service.sysvinit.name }}"
    enabled: "{{ service.enabled }}"
    state: "{{ service.state }}"
    runlevel: "{{ service.sysvinit.runlevel | default (omit) }}"
  loop: "{{ services_state_list | flatten }}"
  loop_control:
    loop_var: service
  ignore_errors: true
  when: ansible_service_mgr == "sysvinit"


- name: manage systemd services
  systemd:
    name: "{{ service.systemd.name }}"
    enabled: "{{ service.enabled }}"
    state: "{{ service.state }}"
    masked: "{{ service.systemd.masked | default (omit) }}"
    scope: "{{ service.systemd.scope | default (omit) }}"
    daemon_reload: yes
  loop: "{{ services_state_list | flatten }}"
  loop_control:
    loop_var: service
  ignore_errors: true
  when: ansible_service_mgr == "systemd"
